<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>ראשונים על ספרים</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>מאגר ראשונים על ספרים</h1>

    {% if category_tree %}
      {% for main_cat, subcats in category_tree.items() %}
	<div id="category-tree">
		<script>
		  const categoryTree = {{ category_tree | tojson }};
		  const container = document.getElementById('category-tree');

		  function createCategoryNode(name, children) {
			const wrapper = document.createElement('div');
			wrapper.style.marginRight = '20px';

			const item = document.createElement('div');
			item.textContent = name;
			item.style.cursor = 'pointer';
			item.style.fontWeight = 'bold';
			item.onclick = () => {
			  if (subList.style.display === 'none') {
				subList.style.display = 'block';
			  } else {
				subList.style.display = 'none';
			  }
			};

			const subList = document.createElement('div');
			subList.style.display = 'none';
			subList.style.marginRight = '20px';

			if (typeof children === 'object') {
			  for (const [subName, subChildren] of Object.entries(children)) {
				subList.appendChild(createCategoryNode(subName, subChildren));
			  }
			} else if (Array.isArray(children)) {
			  for (const leaf of children) {
				const leafDiv = document.createElement('div');
				leafDiv.textContent = leaf;
				leafDiv.style.marginRight = '20px';
				leafDiv.style.cursor = 'pointer';
				subList.appendChild(leafDiv);
			  }
			}

			wrapper.appendChild(item);
			wrapper.appendChild(subList);
			return wrapper;
		  }

		  for (const [mainCat, subCats] of Object.entries(categoryTree)) {
			container.appendChild(createCategoryNode(mainCat, subCats));
		  }
		</script>
    </div>
      {% endfor %}
    {% endif %}

    <h2>רשימת ראשונים</h2>
    {% for רשומה in rishonim %}
    <div class="card">
      <strong>שם הספר:</strong> {{ רשומה.book_name }}<br>
      <strong>שם הסופר:</strong> {{ רשומה.author_name }} ({{ רשומה.author_nickname }})<br>
      <strong>שיוך:</strong> {{ רשומה.origin }}<br>
      <strong>פורסם ב:</strong> {{ רשומה.published }}<br>
      <strong>סיווג:</strong> {{ רשומה.category }}
    </div>
    {% endfor %}

    <a href="{{ url_for('app_routes.add.add_rishon') }}">
      <button>הוסף ראשון חדש</button>
    </a>
  </div>
</body>
</html>
