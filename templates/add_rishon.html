<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>הוסף ראשון</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
	<form method="POST" action="{{ url_for('app_routes.add.add_rishon') }}">
	  <label>קטגוריה:</label>
	  <select id="main-category" name="main_category" required></select>

	  <label>תת קטגוריה:</label>
	  <select id="sub-category" name="sub_category" required></select>

	  <label>תת תת קטגוריה:</label>
	  <select id="sub-sub-category" name="sub_sub_category" required></select>

	  <label>תת תת תת קטגוריה:</label>
	  <select id="sub-sub-sub-category" name="sub_sub_sub_category" required></select>

	  <label>שם הספר:</label>
	  <input type="text" name="book_name" required>

	  <label>שם הסופר:</label>
	  <input type="text" name="author_name" required>

	  <label>כינוי הסופר:</label>
	  <input type="text" name="author_nickname" required>

	  <label>שיוך:</label>
	  <input type="text" name="region" required>

	  <label>היכן פורסם:</label>
	  <input type="text" name="published" required>

	  <br><button type="submit">הוסף ראשון</button>
	</form>

	<a href="{{ url_for('app_routes.home.index') }}" class="btn">← חזרה לדף הבית</a>

	<script>
	  const categoryTree = {{ category_tree | tojson }};

	  const mainCategory = document.getElementById('main-category');
	  const subCategory = document.getElementById('sub-category');
	  const subsubCategory = document.getElementById('sub-sub-category');
	  const subsubsubCategory = document.getElementById('sub-sub-sub-category');

	  function populateSelect(selectElem, options) {
		selectElem.innerHTML = '';
		for (const key in options) {
		  const opt = document.createElement('option');
		  opt.value = key;
		  opt.innerText = key;
		  selectElem.appendChild(opt);
		}
	  }

	  function populateArraySelect(selectElem, array) {
		selectElem.innerHTML = '';
		for (const item of array) {
		  const opt = document.createElement('option');
		  opt.value = item;
		  opt.innerText = item;
		  selectElem.appendChild(opt);
		}
	  }

	  mainCategory.addEventListener('change', () => {
		const selected = mainCategory.value;
		populateSelect(subCategory, categoryTree[selected]);
		subCategory.dispatchEvent(new Event('change'));
	  });

	  subCategory.addEventListener('change', () => {
		const selectedMain = mainCategory.value;
		const selectedSub = subCategory.value;
		populateSelect(subCategory, categoryTree[selectedMain][selectedSub]);
		subsubCategory.dispatchEvent(new Event('change'));
	  });

	  subsubCategory.addEventListener('change', () => {
		const selectedMain = mainCategory.value;
		const selectedSub = subCategory.value;
		const selectedSubsub = subsubCategory.value;
		populateArraySelect(subsubsubCategory, categoryTree[selectedMain][selectedSub][selectedSubsub]);
	  });

	  // הפעלה ראשונית
	  populateSelect(mainCategory, categoryTree);
	  mainCategory.dispatchEvent(new Event('change'));
	</script>
<body>
