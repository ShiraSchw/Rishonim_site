<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>חיפוש לפי ראשון</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="inner-page">
{% include "navbar.html" %}
  <h1>בחר ראשון</h1>

  <select id="rishon-select">
    <option disabled selected>בחר ראשון</option>
    {% for rishon in rishonim %}
      <option value="{{ rishon.id }}">
        {{ rishon.name }}{% if rishon.full_name %} ({{ rishon.full_name }}){% endif %}
      </option>
    {% endfor %}
  </select>

  <button id="search-button" style="display: none;">חפש</button>

  <div id="results-container"></div>

  <script>
    const select = document.getElementById("rishon-select");
    const searchButton = document.getElementById("search-button");
    const resultsContainer = document.getElementById("results-container");

    // בתחילה מוסתר
    searchButton.style.display = 'none';

    // כשהמשתמש בוחר ערך – הצג את הכפתור
    select.addEventListener("change", () => {
      if (select.value) {
        searchButton.style.display = 'inline-block';
      }
    });

    searchButton.addEventListener("click", () => {
      const id = select.value;
      if (!id) return;

      fetch("{{ url_for('app_routes.search_by_rishon.search_by_rishon') }}" + "?rishon_id=" + encodeURIComponent(id))
        .then(res => res.json())
        .then(data => {
          resultsContainer.innerHTML = '';
          if (data.length === 0) {
            resultsContainer.innerHTML = '<p>לא נמצאו ספרים</p>';
          } else {
            data.forEach(item => {
              const card = document.createElement('div');
              card.className = 'rishon-card';
              card.innerHTML = `
                <div class="title">${item.book_name}</div>
                ${item.name ? `<div><strong>ראשון:</strong> ${item.name}</div>` : ''}
                ${item.full_name ? `<div><strong>שם מלא:</strong> ${item.full_name}</div>` : ''}
                ${item.beit_midrash ? `<div><strong>בית מדרש:</strong> ${item.beit_midrash}</div>` : ''}
                ${item.publication_place ? `<div><strong>מקום פרסום:</strong> ${item.publication_place}</div>` : ''}
              `;
              resultsContainer.appendChild(card);
            });
          }
        });
    });
  </script>
</body>
</html>
